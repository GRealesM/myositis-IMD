#########################################
##                                     ##
##     Get PC correlation matrix       ##
##                                     ##
#########################################

# Author: Guillermo Reales 
# Date last updated: 2024/05/07

# Background: Responding to a reviewer query, we wanted to see how PCs are correlated. To do that we'll get info from the basis itself.

library(cupcake)

pids <- row.names(rot.pca)
v <- shrinkage[pids] * rot.pca[pids,]
var.proj  <- t(v) %*% LD[pids,pids] %*% v
var.proj
            #    PC1           PC2           PC3           PC4           PC5           PC6           PC7           PC8           PC9          PC10          PC11           PC12          PC13
# PC1   1.642502e-02  8.880936e-05  0.0025426989  1.290804e-03  1.743539e-04 -2.225282e-04  0.0015719340  4.131792e-04  0.0006191450 -0.0003075259 -8.058438e-04  -3.855811e-04 -0.0013300371
# PC2   8.880936e-05  1.606691e-02 -0.0005608350 -3.142827e-04  1.803281e-03  1.122624e-03 -0.0010184819  5.542484e-04  0.0001283790 -0.0006610698  2.986004e-04   4.413789e-05  0.0006486016
# PC3   2.542699e-03 -5.608350e-04  0.0156772297  7.640160e-04 -3.504074e-04 -2.875676e-04  0.0001204631 -5.367219e-04  0.0008972481 -0.0001233503 -6.106048e-04  -2.172635e-04 -0.0004559463
# PC4   1.290804e-03 -3.142827e-04  0.0007640160  1.524494e-02 -1.190667e-03  4.228647e-04 -0.0002019249  2.019913e-05 -0.0001072872  0.0003529527  6.009221e-04   1.067907e-05  0.0002526875
# PC5   1.743539e-04  1.803281e-03 -0.0003504074 -1.190667e-03  1.419908e-02 -6.974828e-04  0.0004347569 -6.667634e-06 -0.0009730459  0.0015133668  1.046087e-03   1.351764e-04 -0.0002873654
# PC6  -2.225282e-04  1.122624e-03 -0.0002875676  4.228647e-04 -6.974828e-04  1.454031e-02 -0.0010607598  7.212399e-04 -0.0020908526 -0.0004656394 -4.465005e-05   3.445910e-04  0.0005356777
# PC7   1.571934e-03 -1.018482e-03  0.0001204631 -2.019249e-04  4.347569e-04 -1.060760e-03  0.0137589383 -1.702597e-04 -0.0002611653 -0.0006388791  2.584718e-04  -3.745658e-04 -0.0012882589
# PC8   4.131792e-04  5.542484e-04 -0.0005367219  2.019913e-05 -6.667634e-06  7.212399e-04 -0.0001702597  1.449041e-02 -0.0010374754 -0.0006020322 -9.318096e-04  -1.658534e-04  0.0001535527
# PC9   6.191450e-04  1.283790e-04  0.0008972481 -1.072872e-04 -9.730459e-04 -2.090853e-03 -0.0002611653 -1.037475e-03  0.0149754780 -0.0003932898  3.905699e-04  -8.790126e-04  0.0002071271
# PC10 -3.075259e-04 -6.610698e-04 -0.0001233503  3.529527e-04  1.513367e-03 -4.656394e-04 -0.0006388791 -6.020322e-04 -0.0003932898  0.0217574445 -6.823124e-04   7.100148e-04  0.0001140349
# PC11 -8.058438e-04  2.986004e-04 -0.0006106048  6.009221e-04  1.046087e-03 -4.465005e-05  0.0002584718 -9.318096e-04  0.0003905699 -0.0006823124  1.486909e-02  -1.464568e-03 -0.0003301295
# PC12 -3.855811e-04  4.413789e-05 -0.0002172635  1.067907e-05  1.351764e-04  3.445910e-04 -0.0003745658 -1.658534e-04 -0.0008790126  0.0007100148 -1.464568e-03   1.399674e-02 -0.0002977169
# PC13 -1.330037e-03  6.486016e-04 -0.0004559463  2.526875e-04 -2.873654e-04  5.356777e-04 -0.0012882589  1.535527e-04  0.0002071271  0.0001140349 -3.301295e-04  -2.977169e-04  0.0172134849

var.proj <- as.matrix(var.proj)
vc <- sqrt(diag(var.proj)) %*% t(sqrt(diag(var.proj)))
cr = var.proj/vc
cr











